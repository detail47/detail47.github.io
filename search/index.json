[{"content":"ADC简介 ADC（Analog-Digital Converter）模拟-数字转换器 ADC可以将引脚上连续变化的模拟电压转换为内存中存储的数字变量，建立模拟电路到数字电路的桥梁 12位逐次逼近型ADC，1us转换时间 输入电压范围：03.3V，转换结果范围：04095 18个输入通道，可测量16个外部和2个内部信号源 规则组和注入组两个转换单元 模拟看门狗自动监测输入电压范围 STM32F103C8T6 ADC资源：ADC1、ADC2，10个外部输入通道 通道 ADC1 ADC2 ADC3 通道0 PA0 PA0 PA0 通道1 PA1 PA1 PA1 通道2 PA2 PA2 PA2 通道3 PA3 PA3 PA3 通道4 PA4 PA4 PF6 通道5 PA5 PA5 PF7 通道6 PA6 PA6 PF8 通道7 PA7 PA7 PF9 通道8 PB0 PB0 PF10 通道9 PB1 PB1 通道10 PC0 PC0 PC0 通道11 PC1 PC1 PC1 通道12 PC2 PC2 PC2 通道13 PC3 PC3 PC3 通道14 PC4 PC4 通道15 PC5 PC5 通道16 温度传感器 通道17 内部参考电压 转换模式 单次转换，非扫描模式 单次转换，非扫描模式 连续转换，非扫描模式 连续转换，非扫描模式 数据对齐 触发控制 AD转换的步骤：采样，保持，量化，编码 STM32 ADC的总转换时间为： $$T_{CONV} = T_{sampling} + 12.5T_{ADC}$$ 例如：当ADCCLK=14MHz，采样时间为1.5个ADC周期 $$ T_{CONV} = (1.5 + 12.5)T_{ADC} = 14T_{ADC} = 1μs$$ 代码 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 //配置时钟 RCC_APB2PeriphClockCmd(RCC_APB2Periph_ADC1, ENABLE); RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA, ENABLE); RCC_ADCCLKConfig(RCC_PCLK2_Div6); //GPIO配置 GPIO_InitTypeDef GPIO_InitStructure; GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AIN; GPIO_InitStructure.GPIO_Pin = GPIO_Pin_0 | GPIO_Pin_1 | GPIO_Pin_2 | GPIO_Pin_3; GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz; GPIO_Init(GPIOA, \u0026amp;GPIO_InitStructure); //ADC配置 ADC_InitTypeDef ADC_InitStructure; ADC_InitStructure.ADC_Mode = ADC_Mode_Independent; ADC_InitStructure.ADC_DataAlign = ADC_DataAlign_Right; ADC_InitStructure.ADC_ExternalTrigConv = ADC_ExternalTrigConv_None; ADC_InitStructure.ADC_ContinuousConvMode = DISABLE; ADC_InitStructure.ADC_ScanConvMode = DISABLE; ADC_InitStructure.ADC_NbrOfChannel = 1; ADC_Init(ADC1, \u0026amp;ADC_InitStructure); //ADC使能 ADC_Cmd(ADC1, ENABLE); //ADC校准 ADC_ResetCalibration(ADC1); while (ADC_GetResetCalibrationStatus(ADC1) == SET); ADC_StartCalibration(ADC1); while (ADC_GetCalibrationStatus(ADC1) == SET); //获取值 uint16_t AD_GetValue(uint8_t ADC_Channel) { ADC_RegularChannelConfig(ADC1, ADC_Channel, 1, ADC_SampleTime_55Cycles5); ADC_SoftwareStartConvCmd(ADC1, ENABLE); while (ADC_GetFlagStatus(ADC1, ADC_FLAG_EOC) == RESET); return ADC_GetConversionValue(ADC1); } RCC_ADCCLKConfig函数用于配置ADC时钟分频（ADC最高支持14M时钟） GPIO_InitTypeDef为ADC配置结构体 ADC_Mode为ADC模式 ADC_DataAlign为数据对齐模式 ADC_ExternalTrigConv为外部触发模式 ADC_ContinuousConvMode为连续转换使能 ADC_ScanConvMode为扫描模式使能 ADC_NbrOfChannel为ADC通道数 ADC_ResetCalibration函数用于复位ADC校准寄存器 ADC_GetResetCalibrationStatus函数用于检查ADC校准寄存器状态 ADC_StartCalibration函数用于校准ADC ADC_GetCalibrationStatus函数用于检查ADC校准 ADC_RegularChannelConfig函数用于配置规则组通道 ADC_Channel为ADC通道：ADC_Channel_x ADC_SampleTime为采样时间 ADC_GetFlagStatus函数用于获取ADC标志位 ADC_GetConversionValue函数用于获取规则组结果 ADC_SoftwareStartConvCmd函数用于软件触发ADC RCC_PCLK2 值 描述 RCC_PCLK2_Div2 ((uint32_t)0x00000000) 二分频 RCC_PCLK2_Div4 ((uint32_t)0x00004000) 四分频 RCC_PCLK2_Div6 ((uint32_t)0x00008000) 六分频 RCC_PCLK2_Div8 ((uint32_t)0x0000C000) 八分频 ADC_Mode 值 描述 ADC_Mode_Independent ((uint32_t)0x00000000) 独立模式 ADC_Mode_RegInjecSimult ((uint32_t)0x00010000) 混合的同步规则+注入同步模式 ADC_Mode_RegSimult_AlterTrig ((uint32_t)0x00020000) 混合的同步规则+交替触发模式 ADC_Mode_InjecSimult_FastInterl ((uint32_t)0x00030000) 混合同步注入+快速交叉模式 ADC_Mode_InjecSimult_SlowInterl ((uint32_t)0x00040000) 混合同步注入+慢速交叉模式 ADC_Mode_InjecSimult ((uint32_t)0x00050000) 注入同步模式 ADC_Mode_RegSimult ((uint32_t)0x00060000) 规则同步模式 ADC_Mode_FastInterl ((uint32_t)0x00070000) 快速交叉模式 ADC_Mode_SlowInterl ((uint32_t)0x00080000) 慢速交叉模式 ADC_Mode_AlterTrig ((uint32_t)0x00090000) 交替触发模式 更多ADC_Mode的相关内容：STM32F10xxx参考手册（中文）.pdf 页码163/手册11.9\nADC_DataAlign 值 描述 ADC_DataAlign_Right ((uint32_t)0x00000000) 右对齐 ADC_DataAlign_Left ((uint32_t)0x00000800) 左对齐 ADC_ExternalTrigConv 值 描述 ADC_ExternalTrigConv_T1_CC1 ((uint32_t)0x00000000) 内部信号 ADC_ExternalTrigConv_T1_CC2 ((uint32_t)0x00020000) 内部信号 ADC_ExternalTrigConv_T2_CC2 ((uint32_t)0x00060000) 内部信号 ADC_ExternalTrigConv_T3_TRGO ((uint32_t)0x00080000) 内部信号 ADC_ExternalTrigConv_T4_CC4 ((uint32_t)0x000A0000) 内部信号 ADC_ExternalTrigConv_Ext_IT11_TIM8_TRGO ((uint32_t)0x000C0000) 外部引脚/内部信号 ADC_ExternalTrigConv_T1_CC3 ((uint32_t)0x00040000) 内部信号 ADC_ExternalTrigConv_None ((uint32_t)0x000E0000) 软件触发 ADC_ExternalTrigConv_T3_CC1 ((uint32_t)0x00000000) 内部信号 ADC_ExternalTrigConv_T2_CC3 ((uint32_t)0x00020000) 内部信号 ADC_ExternalTrigConv_T8_CC1 ((uint32_t)0x00060000) 内部信号 ADC_ExternalTrigConv_T8_TRGO ((uint32_t)0x00080000) 内部信号 ADC_ExternalTrigConv_T5_CC1 ((uint32_t)0x000A0000) 内部信号 ADC_ExternalTrigConv_T5_CC3 ((uint32_t)0x000C0000) 内部信号 前六个与后六个分别对应ADC12和ADC3，第七、八个可用于ADC123 更多外部触发相关内容：STM32F10xxx参考手册（中文）.pdf 页码162/手册11.7\nADC_SampleTime 值 描述 ADC_SampleTime_1Cycles5 ((uint8_t)0x00) Sample time equal to 1.5 cycles ADC_SampleTime_7Cycles5 ((uint8_t)0x01) Sample time equal to 7.5 cycles ADC_SampleTime_13Cycles5 ((uint8_t)0x02) Sample time equal to 13.5 cycles ADC_SampleTime_28Cycles5 ((uint8_t)0x03) Sample time equal to 28.5 cycles ADC_SampleTime_41Cycles5 ((uint8_t)0x04) Sample time equal to 41.5 cycles ADC_SampleTime_55Cycles5 ((uint8_t)0x05) Sample time equal to 55.5 cycles ADC_SampleTime_71Cycles5 ((uint8_t)0x06) Sample time equal to 71.5 cycles ADC_SampleTime_239Cycles5 ((uint8_t)0x07) Sample time equal to 239.5 cycles ","date":"2024-02-16T00:00:00Z","permalink":"https://detail47.github.io/p/stm32-adc/","title":"STM32 ADC"},{"content":"STM32 STM32是ST公司基于ARM Cortex-M内核开发的32位微控制器 STM32常应用在嵌入式领域，如智能车、无人机、机器人、无线通信、物联网、工业控制、娱乐电子产品等 STM32功能强大、性能优异、片上资源丰富、功耗低，是一款经典的嵌入式微控制器 ARM ARM既指ARM公司，也指ARM处理器内核 ARM公司是全球领先的半导体知识产权（IP）提供商，全世界超过95%的智能手机和平板电脑都采用ARM架构 ARM公司设计ARM内核，半导体厂商完善内核周边电路并生产芯片 STM32F103C8T6 系列：主流系列STM32F1 内核：ARM Cortex-M3 主频：72MHz RAM：20K（SRAM） ROM：64K（Flash） 供电：2.0~3.6V（标准3.3V） 封装：LQFP48 片上资源/外设 英文缩写 名称 NVIC 嵌套向量中断控制器 SysTick 系统滴答定时器 RCC 复位和时钟控制 GPIO 通用IO口 AFIO 复用IO口 EXTI 外部中断 TIM 定时器 ADC 模数转换器 DMA 直接内存访问 USART 同步/异步串口通信 I2C I2C通信 SPI SPI通信 CAN CAN通信 USB USB通信 RTC 实时时钟 CRC CRC校验 PWR 电源控制 BKP 备份寄存器 IWDG 独立看门狗 WWDG 窗口看门狗 DAC 数模转换器 SDIO SD卡接口 FSMC 可变静态存储控制器 USB OTG USB主机接口 命名规则 引脚定义 引脚重映射 1 2 3 RCC_APB2PeriphClockCmd(RCC_APB2Periph_AFIO, ENABLE); GPIO_PinRemapConfig(GPIO_PartialRemap1_TIM2, ENABLE); GPIO_PinRemapConfig(GPIO_Remap_SWJ_JTAGDisable, ENABLE); 使用引脚重映射时，需要开启AFIO时钟 该代码禁用PA15和PB3的JTAG调试，重映射为TIM2 更多PinRemapConfig的相关内容：STM32F10xxx参考手册（中文）.pdf 页码116/手册8.3\n启动配置 最小系统电路 RCC时钟树 ","date":"2024-02-05T00:00:00Z","permalink":"https://detail47.github.io/p/stm32-brief/","title":"STM32简介"}]